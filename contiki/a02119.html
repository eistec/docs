<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Contiki 3.x: Architecture specific functionality for the ELF loader.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Contiki 3.x
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Architecture specific functionality for the ELF loader.<div class="ingroups"><a class="el" href="a02120.html">The Contiki ELF loader</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>The architecture specific functionality for the Contiki ELF loader has to be implemented for each processor type Contiki runs on.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:a00659"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00659.html">elfloader-arch.h</a></td></tr>
<tr class="memdesc:a00659"><td class="mdescLeft">&#160;</td><td class="mdescRight"><pre class="fragment">    Header file for the architecture specific parts of the Contiki ELF loader.</pre> <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01130"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01130.html">elfloader-arch-otf.h</a></td></tr>
<tr class="memdesc:a01130"><td class="mdescLeft">&#160;</td><td class="mdescRight"><pre class="fragment">    Header file for the architecture specific parts of the Contiki ELF loader.</pre> <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga1583b48c655f508d845d1a22bd54d2a3"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a02119.html#ga1583b48c655f508d845d1a22bd54d2a3">elfloader_arch_allocate_ram</a> (int size)</td></tr>
<tr class="memdesc:ga1583b48c655f508d845d1a22bd54d2a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate RAM for a new module.  <a href="#ga1583b48c655f508d845d1a22bd54d2a3">More...</a><br/></td></tr>
<tr class="separator:ga1583b48c655f508d845d1a22bd54d2a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabf03ff0788cfecc08e82ec0fc3bff6f7"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a02119.html#gabf03ff0788cfecc08e82ec0fc3bff6f7">elfloader_arch_allocate_rom</a> (int size)</td></tr>
<tr class="memdesc:gabf03ff0788cfecc08e82ec0fc3bff6f7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate program memory for a new module.  <a href="#gabf03ff0788cfecc08e82ec0fc3bff6f7">More...</a><br/></td></tr>
<tr class="separator:gabf03ff0788cfecc08e82ec0fc3bff6f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab20475a2c29caa2906b860368895944b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a02119.html#gab20475a2c29caa2906b860368895944b">elfloader_arch_relocate</a> (int fd, unsigned int sectionoffset, char *sectionaddr, struct elf32_rela *rela, char *addr)</td></tr>
<tr class="memdesc:gab20475a2c29caa2906b860368895944b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Perform a relocation.  <a href="#gab20475a2c29caa2906b860368895944b">More...</a><br/></td></tr>
<tr class="separator:gab20475a2c29caa2906b860368895944b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga83a40c77924d5791d8ec67f3465a99de"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a02119.html#ga83a40c77924d5791d8ec67f3465a99de">elfloader_arch_write_rom</a> (int fd, unsigned short textoff, unsigned int size, char *mem)</td></tr>
<tr class="memdesc:ga83a40c77924d5791d8ec67f3465a99de"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write to read-only memory (for example the text segment).  <a href="#ga83a40c77924d5791d8ec67f3465a99de">More...</a><br/></td></tr>
<tr class="separator:ga83a40c77924d5791d8ec67f3465a99de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga910cf34ca87a7c3440be13468a1ee920"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a02119.html#ga910cf34ca87a7c3440be13468a1ee920">elfloader_arch_relocate</a> (int input_fd, struct <a class="el" href="a00102.html">elfloader_output</a> *output, unsigned int sectionoffset, char *sectionaddr, struct elf32_rela *rela, char *addr)</td></tr>
<tr class="memdesc:ga910cf34ca87a7c3440be13468a1ee920"><td class="mdescLeft">&#160;</td><td class="mdescRight">Perform a relocation.  <a href="#ga910cf34ca87a7c3440be13468a1ee920">More...</a><br/></td></tr>
<tr class="separator:ga910cf34ca87a7c3440be13468a1ee920"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The architecture specific functionality for the Contiki ELF loader has to be implemented for each processor type Contiki runs on. </p>
<p>Since the ELF format is slightly different for different processor types, the Contiki ELF loader is divided into two parts: the generic ELF loader module (<a class="el" href="a02120.html">The Contiki ELF loader</a>) and the architecture specific part (this module). The architecture specific part deals with memory allocation, code and data relocation, and writing the relocated ELF code into program memory.</p>
<p>To port the Contiki ELF loader to a new processor type, this module has to be implemented for the new processor type. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga1583b48c655f508d845d1a22bd54d2a3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* elfloader_arch_allocate_ram </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate RAM for a new module. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td>The size of the requested memory. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A pointer to the allocated RAM <pre class="fragment">        This function is called from the Contiki ELF loader to
        allocate RAM for the module to be loaded into.
</pre></dd></dl>

<p>Definition at line <a class="el" href="a00660_source.html#l00074">74</a> of file <a class="el" href="a00660_source.html">elfloader-avr.c</a>.</p>

<p>References <a class="el" href="a00629_source.html#l00083">mmem_alloc()</a>, <a class="el" href="a00629_source.html#l00119">mmem_free()</a>, <a class="el" href="a00630_source.html#l00075">MMEM_PTR</a>, and <a class="el" href="a01725_source.html#l00186">NULL</a>.</p>

<p>Referenced by <a class="el" href="a00664_source.html#l00339">elfloader_load()</a>.</p>

</div>
</div>
<a class="anchor" id="gabf03ff0788cfecc08e82ec0fc3bff6f7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* elfloader_arch_allocate_rom </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate program memory for a new module. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td>The size of the requested memory. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A pointer to the allocated program memory <pre class="fragment">        This function is called from the Contiki ELF loader to
        allocate program memory (typically ROM) for the module
        to be loaded into.
</pre></dd></dl>

<p>Definition at line <a class="el" href="a00660_source.html#l00095">95</a> of file <a class="el" href="a00660_source.html">elfloader-avr.c</a>.</p>

<p>Referenced by <a class="el" href="a00664_source.html#l00339">elfloader_load()</a>.</p>

</div>
</div>
<a class="anchor" id="ga910cf34ca87a7c3440be13468a1ee920"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int elfloader_arch_relocate </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>input_fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00102.html">elfloader_output</a> *&#160;</td>
          <td class="paramname"><em>output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>sectionoffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>sectionaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct elf32_rela *&#160;</td>
          <td class="paramname"><em>rela</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Perform a relocation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">output</td><td>The output object for the segment. </td></tr>
    <tr><td class="paramname">sectionoffset</td><td>The file offset at which the relocation can be found. </td></tr>
    <tr><td class="paramname">sectionaddr</td><td>The section start address (absolute runtime). </td></tr>
    <tr><td class="paramname">rela</td><td>A pointer to an ELF32 rela structure (struct elf32_rela). </td></tr>
    <tr><td class="paramname">addr</td><td>The relocated address. <pre class="fragment">        This function is called from the Contiki ELF loader to
        perform a relocation on a piece of code or data. The
        relocated address is calculated by the Contiki ELF
        loader, based on information in the ELF file, and it is
        the responsibility of this function to patch the
        executable code. The Contiki ELF loader passes a
        pointer to an ELF32 rela structure (struct elf32_rela)
        that contains information about how to patch the
        code. This information is different from processor to
        processor.</pre> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a01123_source.html#l00022">22</a> of file <a class="el" href="a01123_source.html">elfloader-arm.c</a>.</p>

<p>References <a class="el" href="a00564_source.html#l01042">cfs_seek()</a>, <a class="el" href="a00571_source.html#l00127">CFS_SEEK_SET</a>, <a class="el" href="a00665_source.html#l00083">ELFLOADER_OK</a>, and <a class="el" href="a01132_source.html#l00129">ELFLOADER_UNHANDLED_RELOC</a>.</p>

</div>
</div>
<a class="anchor" id="gab20475a2c29caa2906b860368895944b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void elfloader_arch_relocate </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>sectionoffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>sectionaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct elf32_rela *&#160;</td>
          <td class="paramname"><em>rela</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Perform a relocation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>The file descriptor for the ELF file. </td></tr>
    <tr><td class="paramname">sectionoffset</td><td>The file offset at which the relocation can be found. </td></tr>
    <tr><td class="paramname">sectionaddr</td><td>The section start address (absolute runtime). </td></tr>
    <tr><td class="paramname">rela</td><td>A pointer to an ELF32 rela structure (struct elf32_rela). </td></tr>
    <tr><td class="paramname">addr</td><td>The relocated address. <pre class="fragment">        This function is called from the Contiki ELF loader to
        perform a relocation on a piece of code or data. The
        relocated address is calculated by the Contiki ELF
        loader, based on information in the ELF file, and it is
        the responsibility of this function to patch the
        executable code. The Contiki ELF loader passes a
        pointer to an ELF32 rela structure (struct elf32_rela)
        that contains information about how to patch the
        code. This information is different from processor to
        processor.</pre> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00660_source.html#l00176">176</a> of file <a class="el" href="a00660_source.html">elfloader-avr.c</a>.</p>

<p>References <a class="el" href="a00564_source.html#l01042">cfs_seek()</a>, <a class="el" href="a00571_source.html#l00136">CFS_SEEK_CUR</a>, <a class="el" href="a00571_source.html#l00127">CFS_SEEK_SET</a>, and <a class="el" href="a01132_source.html#l00129">ELFLOADER_UNHANDLED_RELOC</a>.</p>

</div>
</div>
<a class="anchor" id="ga83a40c77924d5791d8ec67f3465a99de"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void elfloader_arch_write_rom </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short&#160;</td>
          <td class="paramname"><em>textoff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>mem</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write to read-only memory (for example the text segment). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>The file descriptor for the ELF file. </td></tr>
    <tr><td class="paramname">textoff</td><td>Offset of text segment relative start of file. </td></tr>
    <tr><td class="paramname">size</td><td>The size of the text segment. </td></tr>
    <tr><td class="paramname">mem</td><td>A pointer to the where the text segment should be flashed <pre class="fragment">        This function is called from the Contiki ELF loader to
        write the program code (text segment) of a loaded
        module into memory. The function is called when all
        relocations have been performed.</pre> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00660_source.html#l00115">115</a> of file <a class="el" href="a00660_source.html">elfloader-avr.c</a>.</p>

<p>References <a class="el" href="a00564_source.html#l01042">cfs_seek()</a>, <a class="el" href="a00571_source.html#l00127">CFS_SEEK_SET</a>, <a class="el" href="a01295_source.html#l00086">flash_clear()</a>, <a class="el" href="a01295_source.html#l00076">flash_done()</a>, <a class="el" href="a01295_source.html#l00048">flash_setup()</a>, <a class="el" href="a01295_source.html#l00098">flash_write()</a>, and <a class="el" href="a01256_source.html#l06419">PORTB</a>.</p>

<p>Referenced by <a class="el" href="a00664_source.html#l00339">elfloader_load()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Nov 30 2014 09:59:03 for Contiki 3.x by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
